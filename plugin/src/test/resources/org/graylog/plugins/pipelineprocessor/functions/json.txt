rule "json"
when
  true
then
  let json = parse_json(to_string($message.flat_json));
  set_fields(json);

  // Don't fail on invalid input
  let invalid_json = parse_json("#FOOBAR#");
  set_fields(invalid_json);

  // Don't fail on empty input
  let empty_json = parse_json("");
  set_fields(empty_json);

  // Don't fail on nested input
  let nested_json = parse_json(to_string($message.nested_json));
  set_fields(nested_json);
end