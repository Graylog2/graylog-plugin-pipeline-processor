rule "urls"
when
    true
then
    let url = to_url("https://admin:s3cr31@some.host.with.lots.of.subdomains.com:9999/path1/path2/three?q1=something&with_spaces=hello%20graylog&equal=can=containanotherone#anchorstuff");
    set_fields({
        protocol: url.protocol,
        authority: url.authority,
        user_info: url.userInfo,
        host: url.host,
        port: url.port,
        path: url.path,
        file: url.file,
        fragment: url.fragment,
        query: url.query,
        q1: url.queryParams.q1,
        with_spaces: url.queryParams.with_spaces,
        equal: url.queryParams.equal
    });

    // https://github.com/Graylog2/graylog-plugin-pipeline-processor/issues/207
    let url_query_with_dot = to_url("https://example.com/path.dot?query.with=dot#fragment.dot");
    set_field("url_query_with_dot", url_query_with_dot.query);
    set_field("url_query_with_dot_param", url_query_with_dot.queryParams.`query.with`);

    trigger_test();
end